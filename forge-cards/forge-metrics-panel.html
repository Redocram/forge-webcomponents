<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/polymer/polymer.html">

<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/paper-item/paper-item-body.html">

<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/iron-icons/iron-icons.html">
<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/iron-icons/image-icons.html">

<link rel="import" href="../forge-behaviors/forge-metrics-polling-behavior.html">

<dom-module id="forge-metrics-panel">

<style>
:root {
}

:host {
  display: block;
}

.header{
  display: inline-block;
  box-sizing: border-box;
}

.icon {
  width: 72px;
  height: 72px;
  opacity: 0.5;
  float:right;
}

.text {
  color: var(--paper-grey-900);
  padding: 5px;
  font-size: 18px;
}

.metrics-values{
  padding: 5px;
  height: 90px;
  display: table-cell;
  vertical-align: bottom;
}

.strong{
  font-weight: 600;
  font-size: 24px;
}
</style>

<template>


    <paper-item-body two-line style$="background-color: {{cardcolor}};" class="text">
    <span class="header strong" style$="background-color: {{headcolor}};">[[title]]</span>
    <div class="metrics-values">
      avg	<span class="strong">[[average]]</span>	peak <span class="strong">[[max]]</span>
      <iron-icon class="icon" icon="[[icon]]"></iron-icon>
    </div>
    </paper-item-body>

</template>

<script>
(function() {
  "use strict";

  Polymer({
    is: 'forge-metrics-panel',
    behaviors: [ForgeWebComponents.Behaviors.MetricsPollingBehavior],
    properties: {
      url: {
        type: String
      },
      average: {
        type: Number,
        readOnly: true
      },
      max: {
        type: Number,
        readOnly: true
      },
      // name: {
      //   type: String
      // },
      icon: {
        type: String
      },
      title:{
        type: String
      },
      headcolor: {
        type: String
      },
      cardcolor:{
        type: String
      }
    },
    attached: function() {
      this.startPolling();
    },
    ready: function() {
      this.register(this.url);
    },
    onMetrics: function(result) {
      var self = this;
      var current = result[0];
      console.log(this);
      // var current = result.find(function(r) {
      //   // return r.Name === self.name;
      // });
      if (current) {
        self._setAverage(current.Average.isInfinite || current.Average.isNaN ? 0 : Math.round(current.Average));
        self._setMax(current.Max.isInfinite || current.Max.isNaN ? 0 : Math.round(current.Max));
      }
    }
  });

})();
</script>

</dom-module>
