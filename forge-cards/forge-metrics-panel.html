<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/polymer/polymer.html">

<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/paper-button/paper-button.html">

<link rel="import" href="../forge-behaviors/forge-metrics-polling-behavior.html">

<dom-module id="forge-metrics-panel">

<style>
:root {
}

:host {
  display: block;
}
</style>

<template>

  <h1>[[url]]</h1>
  <p>
    <span>avg: [[average]] peak: [[max]]</span>
  </p>
</template>

<script>
(function() {
  "use strict";

  Polymer({
    is: 'forge-metrics-panel',
    behaviors: [ForgeWebComponents.Behaviors.MetricsPollingBehavior],
    properties: {
      url: {
        type: String
      },
      average:{
        type: Number,
        readOnly: true
      },
      max:{
        type: Number,
        readOnly: true
      },
      name:{
        type: String
      }
    },
    attached: function() {
      this.startPolling();
    },
    ready: function() {
      this.register(this.url);
    },
    onMetrics: function(result) {
      var self = this;
      var current = result.find(function(r) {
        return r.Name === self.name;
      });
      if (current) {
        self._setAverage(current.Average.isInfinite || current.Average.isNaN ? 0 : Math.round(current.Average));
        self._setMax(current.Max.isInfinite || current.Max.isNaN ? 0 : Math.round(current.Max));
      }
    }
  });

})();
</script>

</dom-module>
