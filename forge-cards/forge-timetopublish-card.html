<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/polymer/polymer.html">

<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/paper-styles/color.html">
<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/paper-styles/typography.html">

<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/paper-card/paper-card.html">

<link rel="import" href="../forge-shared/forge-shared.html">
<link rel="import" href="../forge-shared/forge-icons.html">

<link rel="import" href="../forge-behaviors/forge-wcm-published-behavior.html">
<link rel="import" href="../forge-behaviors/forge-localize-behavior.html">

<dom-module id="forge-timetopublish-card">

<style>
:host {
  display: block;
}

.ttp-card {
  display: block;
}

.icon {
  --iron-icon-height: 96px;
  --iron-icon-width: 96px;
  --iron-icon-fill-color: white;
}

.avg-time {
  @apply(--paper-font-title);
  text-align: right;
}

</style>

<template>

  <paper-card class$="ttp-card story" heading = "[[localize(heading)]]">
    <div class="card-content">
      <div class="icon-wrapper" style$="background:[[iconItem.color]]" item-icon>
        <iron-icon class="entity-icon" icon="[[iconItem.icon]]"></iron-icon>
      </div>
      <div class="avg-time">[[entityType]]: [[avgTime]]</div>
    </div>
  </paper-card>

</template>

<script>
(function() {
  "use strict";

  Polymer({
    is: 'forge-timetopublish-card',
    behaviors: [ForgeWebComponents.Behaviors.WcmPublishedPollingBehavior, ForgeWebComponents.Behaviors.ForgeLocalizeBehavior],
    properties: {
      url: {
        type: String
      },
      heading: {
        type: String
      },
      entityType: {
        type: String
      }
    },
    avgTime: Number,
    iconItem: {},
    attached: function() {
      this.polling.register(this.url, this);
      this.polling.start();
    },
    detached: function() {
      this.polling.unregister(this.url, this);
    },
    onPollingUpdate: function(result) {
      var entityType = this.entityType;
      var avgTime;
      result.forEach(function(r) {
        if(r[0] == entityType) avgTime = r[1];
      });
      this.avgTime = avgTime;
      console.log(this.avgTime);
    }
  });

})();
</script>

</dom-module>
