<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/polymer/polymer.html">
<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/paper-input/paper-input.html">
<link rel="import" href="//cdn.rawgit.com/download/polymer-cdn/1.6.1/lib/google-youtube/google-youtube.html">

<dom-module id="forge-youtube-video-input">

  <template>

    <style>
    </style>

    <!-- local DOM goes here -->
    <paper-input value="{{value}}" label="[[label]]" on-input="onInput" on-change="onChange"></paper-input>
    <google-youtube id="googleYouTube" video-id="{{value}}"/>

  </template>

  <script>
  Polymer({
    is: 'forge-youtube-video-input',
    properties: {
      value: {
        type: String
      },
      label: {
        type: String
      },
      entity: {
        type: Object
      },
      schema: {
        type: Object
      }
    },
    _sendCommand: function() {

      const entity = {
        aggregateId: this.entity.entityId,
        translationId: this.entity.id,
        aggregateType: this.entity.fullTypeName || this.entity.type
      }

      const commandBody = {
        aggregateId: entity.aggregateId,
      	aggregateType: entity.aggregateType,
      	translationId: entity.translationId,
        values: {
          videoId: this.value
        }
      };

      this.fire('sendCommand', { commandName: 'SetExtendedFieldsCommand', commandBody: commandBody });

    },
    onInput: function() {
      this.debounce('_sendCommand', this._sendCommand, 2000);
    },
    onChange: function() {
      this.debounce('_sendCommand', this._sendCommand, 0);
    }
  });
  </script>

</dom-module>
