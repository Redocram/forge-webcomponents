<script>
(function() {

  window.ForgeBehaviors = window.ForgeBehaviors || {};
  ForgeBehaviors.ExtendedFieldStringBehavior = {

    properties: {
      value: {
        type: String
      },
      label: {
        type: String
      },
      fieldName: {
        type: String
      },
      entity: {
        type: Object
      },
      schema: {
        type: Object
      }
    },
    triggerSendCommand: function() {

      const entity = {
        aggregateId: this.entity.entityId,
        translationId: this.entity.id,
        aggregateType: this.entity.fullTypeName || this.entity.type
      };

      if (!entity.aggregateId
      || !entity.translationId
      || !entity.aggregateType) {
        throw "Invalid entity status (entity is not existing or not initialized correctly)";
      }

      if (this._lastKnownValue === this.value) return;
      this._lastKnownValue = this.value;

      const commandBody = {
        aggregateId: entity.aggregateId,
        aggregateType: entity.aggregateType,
        translationId: entity.translationId,
        values: {}
      };

      commandBody.values[this.fieldName] = this.value;

      this.fire('sendCommand', { commandName: 'SetExtendedFieldsCommand', commandBody: commandBody });

    },
    triggerOnValueChanged: function() {
      if (this._lastKnownValue === this.value) return;
      this._lastKnownValue = this.value;
      this.fire('valueChanged', this.value);
    }
  };

})();
</script>
